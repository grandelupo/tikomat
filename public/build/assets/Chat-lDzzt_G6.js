import{r,v as K,j as e,$ as G}from"./app-eyRcJakc.js";import{B as g}from"./button-m36tyP-B.js";import{C as Q,b as V,c as Y,a as Z}from"./card-Cx2e3m4W.js";import{I as R}from"./input-vrUkcHqo.js";import{B}from"./badge-w20cigAG.js";import{A as C,X as v}from"./app-layout-B8XDgoYK.js";import{P as ee}from"./plus-LLNvhPqE.js";import{M as _}from"./message-circle-D_8SBt3i.js";import{H as S}from"./headphones-Dg4gREWn.js";import{U as se}from"./user-gxutWzve.js";import{L as te}from"./loader-circle-BDI38XVN.js";import{S as ae}from"./send-CJ8pBRnF.js";import{C as O}from"./circle-alert-D-y6hjAx.js";import{C as le}from"./circle-check-big-Db1QLQjH.js";import{C as re}from"./clock-bSBO1nOj.js";import"./index-CNlBQMVC.js";import"./index-C9bbIoIJ.js";import"./workflow-CCsbT4Jc.js";import"./video-B_AWJ4m4.js";import"./calendar-CAFlWtyy.js";function $e({conversations:T,activeConversation:t,messages:P,user:j}){const[o,m]=r.useState(P),[U,$]=r.useState(!1),[k,x]=r.useState("connecting"),[F,f]=r.useState(!1),[E,I]=r.useState(0),M=r.useRef(null),b=r.useRef(null),y=r.useRef(null),{data:c,setData:D,processing:N,reset:A,errors:L}=K({message:"",conversation_id:(t==null?void 0:t.id)||null,subject:""}),z=()=>{var s;(s=M.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{z()},[o]),r.useEffect(()=>{var s;(s=b.current)==null||s.focus()},[]),r.useEffect(()=>{if(!t){x("disconnected");return}o.length>0&&I(Math.max(...o.map(a=>a.id))),x("connected");const s=async()=>{if(t)try{const a=await fetch(`${route("chat.poll")}?conversation_id=${t.id}&last_message_id=${E}`,{headers:{Accept:"application/json"}});if(a.ok){const l=await a.json();if(l.messages&&l.messages.length>0){const u=l.messages.filter(n=>n.is_from_admin);u.length>0&&(m(n=>[...n,...u]),$(!0),setTimeout(()=>$(!1),500)),I(Math.max(...l.messages.map(n=>n.id)))}x("connected")}else x("disconnected")}catch(a){console.error("Polling error:",a),x("disconnected")}};return y.current=setInterval(s,2e3),()=>{y.current&&clearInterval(y.current)}},[t,E]);const H=async s=>{var u,n;if(s.preventDefault(),!c.message.trim())return;const a=c.message,l={id:Date.now(),conversation_id:(t==null?void 0:t.id)||0,user_id:j.id,message:a,is_from_admin:!1,sender_name:j.name,formatted_time:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),created_at:new Date().toISOString(),user:j};m(d=>[...d,l]),A("message"),(u=b.current)==null||u.focus();try{const d=await fetch(route("chat.store"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""},body:JSON.stringify({message:a,conversation_id:(t==null?void 0:t.id)||null})});if(!d.ok)throw new Error("Failed to send message");const i=await d.json();i.success?(m(h=>h.map(p=>p.id===l.id?{...i.message,sender_name:i.message.user.name,formatted_time:new Date(i.message.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}:p)),i.conversation&&!conversation&&console.log("New conversation created:",i.conversation)):(m(h=>h.filter(p=>p.id!==l.id)),console.error("Failed to send message:",i.error))}catch(d){m(i=>i.filter(h=>h.id!==l.id)),console.error("Error sending message:",d)}},W=()=>{if(!t)return{status:"No active conversation",color:"bg-blue-100 text-blue-800",icon:_};switch(t.status){case"waiting":return{status:"Waiting for support agent",color:"bg-yellow-100 text-yellow-800",icon:re};case"active":return{status:"Connected with support",color:"bg-green-100 text-green-800",icon:le};case"closed":return{status:"Conversation closed",color:"bg-gray-100 text-gray-800",icon:O};default:return{status:"Unknown status",color:"bg-gray-100 text-gray-800",icon:O}}},X=async()=>{var s;try{const a=await fetch(route("chat.create"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({subject:c.subject||null})});if(a.ok){const l=await a.json();l.success&&(window.location.href=route("chat.index")+"?conversation_id="+l.conversation.id)}}catch(a){console.error("Error creating conversation:",a)}f(!1),A("subject")},w=W(),q=w.icon,J=[{title:"My channels",href:"/dashboard"},{title:"Live Chat Support",href:"/chat"}];return e.jsxs(C,{breadcrumbs:J,children:[e.jsx(G,{title:"Live Chat Support"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Conversations"}),e.jsxs(g,{onClick:()=>f(!0),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"New"]})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:T.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(_,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No conversations yet"})]}):T.map(s=>e.jsx("a",{href:`${route("chat.index")}?conversation_id=${s.id}`,className:`block p-4 border-b hover:bg-gray-50 ${(t==null?void 0:t.id)===s.id?"bg-blue-50 border-l-4 border-l-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.subject||`Conversation #${s.id}`}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:s.status==="waiting"?"bg-yellow-100 text-yellow-800":s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.status}),s.unread_count_user>0&&e.jsx("span",{className:"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-600 rounded-full",children:s.unread_count_user})]})]})},s.id))})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-white",children:"Live Chat Support"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Get help from our support team"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(B,{className:`${w.color} border-0`,children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),w.status]}),e.jsx("div",{className:`w-2 h-2 rounded-full ${k==="connected"?"bg-green-400":k==="connecting"?"bg-yellow-400":"bg-red-400"}`})]})]})}),e.jsxs("div",{className:"h-96 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Start a conversation"}),e.jsx("p",{className:"text-gray-600",children:"Send a message to connect with our support team."})]}):o.map(s=>e.jsx("div",{className:`flex ${s.is_from_admin?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.is_from_admin?"bg-white text-gray-900 shadow-sm border":"bg-blue-600 text-white"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s.is_from_admin?"bg-blue-100":"bg-blue-500"}`,children:s.is_from_admin?e.jsx(S,{className:`w-3 h-3 ${s.is_from_admin?"text-blue-600":"text-white"}`}):e.jsx(se,{className:`w-3 h-3 ${s.is_from_admin?"text-blue-600":"text-white"}`})}),e.jsx("span",{className:`text-xs font-medium ${s.is_from_admin?"text-gray-600":"text-blue-100"}`,children:s.sender_name}),e.jsx("span",{className:`text-xs ${s.is_from_admin?"text-gray-500":"text-blue-200"}`,children:s.formatted_time})]}),e.jsx("p",{className:"text-sm leading-relaxed",children:s.message})]})},s.id)),U&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg bg-white text-gray-900 shadow-sm border",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Support is typing"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),e.jsx("div",{ref:M})]}),e.jsxs("div",{className:"border-t bg-white p-4",children:[e.jsxs("form",{onSubmit:H,className:"flex space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{ref:b,type:"text",value:c.message,onChange:s=>D("message",s.target.value),placeholder:"Type your message...",disabled:N||(t==null?void 0:t.status)==="closed",className:"w-full"}),L.message&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.message})]}),e.jsx(g,{type:"submit",disabled:N||!c.message.trim()||(t==null?void 0:t.status)==="closed",className:"bg-blue-600 hover:bg-blue-700",children:N?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-gray-500",children:[e.jsx("span",{children:"Press Enter to send"}),e.jsxs("span",{children:[(t==null?void 0:t.status)==="waiting"&&"We'll connect you with an agent shortly",(t==null?void 0:t.status)==="active"&&"Connected with support team",(t==null?void 0:t.status)==="closed"&&"This conversation has been closed",!t&&"Start typing to begin a new conversation"]})]})]})]})})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Start New Conversation"}),e.jsx(g,{onClick:()=>f(!1),variant:"outline",size:"sm",children:e.jsx(v,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject (Optional)"}),e.jsx(R,{type:"text",value:c.subject,onChange:s=>D("subject",s.target.value),placeholder:"What do you need help with?",className:"w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(g,{onClick:()=>f(!1),variant:"outline",children:"Cancel"}),e.jsx(g,{onClick:X,className:"bg-blue-600 hover:bg-blue-700",children:"Start Conversation"})]})]})]})}),e.jsxs(Q,{className:"mt-6",children:[e.jsx(V,{children:e.jsx(Y,{className:"text-lg",children:"Need help?"})}),e.jsx(Z,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Response Times"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Chat: Usually within 5 minutes"}),e.jsx("li",{children:"• Business hours: 10 AM - 6 PM EET"}),e.jsx("li",{children:"• Average response: 2 minutes"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Quick Tips"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Be specific about your issue"}),e.jsx("li",{children:"• Include error messages if any"}),e.jsx("li",{children:"• Mention your account email"})]})]})]})})]})]})})]})}export{$e as default};
